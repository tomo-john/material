# ボリュームのマウント

ボリュームとは、ストレージの1領域を区切ったものを言う。

ハードディスクやSSDの区切られた1領域。(1つのストレージを1つのボリュームとして運用することが多い)

マウントとは、対象を接続してOSやソフトウェアの支配下に置くこと。

コンテナは頻繁に作っては壊すので、データを移し替えたりするのではなく、最初からコンテナの外にデータを保存する。

これを`データの永続化`と言い、このデータを置く場所がマウントした記憶領域。

## 記憶領域のマウントの種類

Dockerには記憶領域をマウントするには2種類の方法がある。

### 1: ボリュームマウント

Docker Engineが管理している領域内にボリュームを作成し、ディスクとしてコンテナにマウントする。

名前だけで管理できるので、手軽に扱える反面、ボリュームに対して、`直接操作しずらい`。

仮で使いたい場合や、滅多に触らないが消してはいけないファイルを置くのに使うことが多い。

### 2: バインドマウント

Dockerをインストールしたパソコンのドキュメントやデスクトップなど、Docker Engineの管理していない場所の既に存在するディレクトリをコンテナにマウントする。

ディレクトリだけでなく、ファイル単位でマウントすることもできる。

ディレクトリに対して直接ファイルを置いたり、開いたりできるため、頻繁に触りたいファイルは、ここに置く。

### 2つのマウント方法の違い

- 簡単かどうか
- ホストPCから操作したいか
- 環境依存を排除したいか

この3点がポイント。

| 項目             | ボリュームマウント           | バインドマウント                       |
|------------------|------------------------------|----------------------------------------|
| 記憶領域         | ボリューム                   | ディレクトやファイル                   |
| マウント場所     | Docker Engine管理下          | どこでもok                             |
| マウント時の操作 | ボリュームを作成してマウント | 既存のファイルやディレクトリをマウント |
| 内容の編集       | Dockerコンテナを経由して行う | 普通のファイルとして扱う               |
| バックアップ     | 複雑な手順                   | 普通のファイルとして扱う               |

## 記憶領域をマウントするコマンド

どちらのマウント方法でも、記憶領域のマウントは`run`コマンドに`-v`オプションを使用して指定する。

マウントしたい記憶領域のパスをコンテナの特定の場所であるように設定することでマウントする。

### 記憶領域をマウントする手順

記憶領域をマウントする場合、先にその記憶領域を作成しておく。

記憶領域を作る => コンテナを作る(マウントする)

### 記憶量機の作り方

バインドマウントの場合、記憶領域を作るには、ディレクトリやファイルを用意する。

ボリュームマウントの場合は`docker volume create ボリューム名`で作成する。

### 実際のやり方

- バインドマウントの場合

  ```
  docker run (省略) -v 実際の記憶領域のパス:コンテナの記憶領域パス (省略)
  ```

- ボリュームマウントの場合

  ```
  docker run (省略) -v ボリューム名:コンテナの記憶領域パス (省略)
  ```

