# 1.Linuxの起動プロセス

1.1 BIOS/UEFI
- 電源ONの後、BIOS/UEFIが起動しハードウェアの初期化を行う
- ブートデバイス(HDDやSSD)を特定し、ブートローダを読込む

1.2 ブートローダ(例: GRUB)
- ブートローダはOSカーネルをメモリに読み込み、制御をOSに渡す
- GRUBがよく使われ、複数のカーネルやOSを選択できる機能を持っている

1.3 カーネル起動
- カーネルがロードされると、メモリ管理やデバイスドライバの初期化などが行われる
- カーネルはinitプロセス(PID1)を起動 → このinitがシステム管理を行う最初のプロセス

1.4 initプロセス(SysVinit)
- SysVinitは古くから使用されているinitシステムで、システムのランレベルを管理する
- `/etc/inittab`ファイルを読み、指定されたランレベルに応じたスクリプトを実行
- スクリプトは`/etc/rc.d/`や`/etc/init.d`に配置されている

# 2.SysVinitの仕組み

2.1 ランレベル

SysVinitはシステムを起動する際に、ランレベルを使用して異なる状態を管理する

ランレベルごとに起動するサービスが変わる

- 0: システム停止
- 1: シングルユーザーモード(メンテナンス用)
- 2: マルチユーザーモード(ネットワークなし)
- 3: マルチユーザーモード(ネットワークあり、GUIなし)
- 4: 未使用のカスタム用
- 5: マルチユーザーモード(GUIあり)
- 6: システム再起動

2.2 `/etc/inittab`ファイル

SysVinitでは`/etc/inittab`ファイルを読込んでどのランレベルでシステムを起動するかを決定する

```shell:/etc/inittab
id:3:initdefault:
```

2.3 initスクリプト

各ランレベルに関連するサービスの起動や停止は、`/etc/rc.d`や`/etc/init.d`にあるスクリプトによって管理される

ランレベルごとに`rcX.d`(Xはランレベル)ディレクトリがあり、`S`で始まるスクリプトがサービスを起動し、

`K`で始まるスクリプトがサービスを停止する

# 3.システムの停止・再起動
- システム停止はランレベル`0`、再起動はランレベル`6`
- `init 0`や`init6`のように`init`コマンドでランレベル変更が可能
- `shutdown`, `reboot`コマンドでも操作は可能

---

# systemd
`systemd`はSysVinitに代わる最新のinitシステムで、多くの現代的なLinuxディストリビューションで採用されている

systemdは単なるinitシステム以上のもので、システム全体の管理を行うためのツールセットでもある

## 1.systemdの特徴

1.1 並列起動
- 並列起動が可能で、起動時に複数のサービスを同時に開始できる
- これにより起動時間が大幅に短縮される

1.2 サービスの依存関係管理
- サービス間の依存関係を詳細に管理する
- あるサービスが起動する前に必要な別のサービスが確実に動作していることを保障する

1.3 ソケットとデーモンの管理
- ソケットベースの起動がサポートされている
- サービスが実際に使用されるタイミングでソケットを介して起動することが可能

1.4 ユニット(Unit)の概念
- サービス、マウントポイント、デバイス、タイマーなどをユニット(Unit)という形で定義する
- `*.service`, `*.mount`, `*.timer`などのファイルで定義され、設定が可能

1.5 ロギング機能
- journalを使用してログ管理機能が統合されている
- サービスやシステムのログを一元的に管理し、詳細な分析が可能
- `journalctl`コマンドで閲覧できる

## 2.systemdの起動プロセス
Linuxカーネルが起動した後、最初に起動されるプロセスがsystemd

systemdは、システムのさまざまなユニットを順次並列に起動し、システム稼働状態にする

2.1 ターゲット(Target)

SysVinitのランレベルに対応する概念が systemdでは`ターゲット(Target)`

ターゲットはシステムの特定の状態を表し、複数のユニットをまとめて管理する

- `graphical.target`: GUIを起動するマルチユーザーモード(ランレベル5相当)
- `multi-user.target`: CLIのみのマルチユーザーモード(ランレベル3相当)
- `rescue.target`: シングルユーザーモード(ランレベル1相当)
- `poweroff.target`: システム停止(ランレベル0相当)
- `reboot.target:`: システムの再起動(ランレベル6相当)

2.2 ユニットファイル

systemdでは、すべてのサービスやプロセスはユニットファイルによって管理される

ユニットファイルは通常、`/etc/systemd/system`や`/lib/systemd/system/`に配置される

各ユニットファイルには、そのサービス設定が記述されている

## 3.systemctlコマンド
systemdを管理するための主要コマンドが`systemctl`

3.1 サービスの管理
- サービスの開始: `sudo systemctl start <service>`
- サービスの停止: `sudo systemctl stop <service>`
- サービスの再起動: `sudo systemctl restart <service>`
- サービスのステータス確認: `sudo systemctl status <service>`

3.2 サービスの自動起動設定
- 自動起動の有効化: `sudo systemctl enable <service>`
- 自動起動の無効化: `sudo systemctl disable <service>`

3.3 ターゲットの管理
- 現在のターゲット確認: `systemctl get-default`
- ターゲットの変更: `sudo systemctl isolate <target>`

3.4 ログの確認
- ジャーナルログの表示: `journalctl`
- 特定のサービスログ表示: `journalctl -u <service>`

---

# BIOS
Basic Input/Output System(BIOS)は、PCハードウェアとOSの橋渡しを行う基本的なファームウェア

BIOSはシステム起動時に最初に実行されるソフトウェア

## 1.BIOSの主な役割
- ハードウェアの初期化:

  システムの電源が入った後、BIOSはまずハードウェアを初期化する

  これにはCPU, メモリ, ディスク, キーボード, マウス, ディスプレイ, その他周辺機器が含まれる

  ハードウェアが正常に動作しているか確認する`POST(Power-On Self Test)`もこの段階で含まれる

- ブートローダのロード:

  BIOSはシステムの起動デバイス(通常はHDDやSSD, USBデバイス)を検索し、ブートローダをメモリに読込む

  LinuxではGRUBなどが使用されており、これを通じてカーネルが起動される

- ハードウェア設定の管理:

  BIOSでは、ディスクの設定、ブートデバイスの優先順位、電源管理、メモリやCPUの設定を行うことが可能

## 2.UEFIとの違い
BIOSもUEFIはどちらもコンピューターのファームウェアで、OSが起動する前にハードウェアを初期化し、

ブートローダをロードする役割を持っている点は同じ

`BIOSの特徴`
- 歴史が古い: 1980年代から使われている伝統的なファームウェア
- 16ビットモードで動作: メモリ空間が1MB未満で制限されている
- MBR(マスターブートレコード)使用: 2TBまでのディスクサイズと4つのプライマリパーティションに制限
- レガシーサポート: 新しい技術への対応が遅く、古いデバイスやシステム向け

`UEFIの特徴`
- 新しい: BIOSの後続として、より現代的な機能を提供する規格
- GPT(GUIDパーティションテーブル)使用: 2TB以上のディスクサイズ、128以上のパーティションをサポート
- 高速ブート: BIOSに比べて起動が高速で、ブートプロセスを高速化する
- セキュアブート: デジタル署名されたOSやドライバのみを起動することでマルウェアの侵入を防ぐ
- 柔軟性: UEFIの設定はGUIインターフェースを通じて行われ使いやすい

---

# ブートローダ
コンピューター起動時にOSを起動するためのプログラム

BIOS/UEFIによって最初に実行され、OSのカーネルをメモリにロードし、OSの起動プロセスを開始する

Linuxでは`GRUB`が主流

## ブートローダの役割
1. ハードウェア初期化
- ブートローダはまず必要なハードウェアを初期化しOS起動の準備を整える

2. カーネルのロード
- ブートローダはOSのカーネルをメモリに読み込み、実行を開始する

3. マルチブートのサポート
- 複数のOSがインストールされている場合、どのOSを起動するかを選択できる

4. 追加オプションの提供
- デバッグやシステムのレスキューモードなど、追加のカーネルオプションを指定して起動することも可能

## 代表的なブートローだ
1. GRUB
- Linuxディストリビューションで最も一般的なブートローだ
- マルチブート対応、複数のOS選択や複雑なカスタムも可能
- GRUB Legacy(旧版)とGRUB2(最新版)の2種類がり、GRUB2が多くのディストリビューションで使用されている

2. LILO(Llnux LOrder)
- GRUBが普及するまでよし使用されていた
- マルチブートの設定やカスタムオプションの柔軟性の低さがGRUBより劣っている

3. SYSLINUX/ISOLINUX
- 主にUSBやCD/DVD、ネットワーク向けに利用されるブートローダ
- ディスクとのシステム(ハードディスクがないシステム)でOSの起動に利用される

## GRUB
GRUB(GRand Unified Bootloader)はLinuxや他のOSのブートローダ

多くのLinuxディストリビューションで標準のブートローダとして採用されている

GRUB Legacy(旧版)とGRUB2(最新版)の2種類が存在する

- GRUB Legacyは以前のバージョンで、設定が難しく、現在はサポートが終了している
- GRUB2は現行バージョンで、多くの機能を備えユーザーフレンドリーな設定方法に変更されている


