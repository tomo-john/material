# Linuxもおける時刻関連

| 種別                 | コマンド | 内容                                                                  |
|----------------------|----------|-----------------------------------------------------------------------|
| ハードウェアクロック | hwclock  | コンピューターに内蔵された時刻。電源OFFでも動作                       |
| システムクロック     | date     | Linuxカーネルが持つ時刻。システム起動時にハードウェアクロック値が設定 |

### hwclock

オプションなし(または`-r`)でハードウェアクロックを表示する。

| オプション    | 内容 |
|---------------|------|
| -r            | ハードウェアクロックを表示(オプションなしと同じ)   |
| -s(--hctosys) | ハードウェアクロックの時刻をシステムクロックに反映 |
| -w(--systohc) | システムクロックの時刻をハードウェアクロックに反映 |

### date

オプションや引数なしで実行すると、現在のにづけ時刻が表示される。

日付時刻変更の書式: `date [MMDDhhmm[[CC]YY][.ss]]`

=> MM: 月, DD: 日, hh: 時, mm: 分, CC: 西暦上2桁, YY: 西暦下2桁, ss: 秒


# NTP

Network Time Protocolはネットワーク経由で正確なクロックを同期(時刻同期)するプロトコル。

時刻同期には認知のタイミングでNTPサーバーから時刻を取得する方法と、NTPデーモン(`ntpd`)により自動え時刻を同期する方法がある。

NTPはUDPポートの`123番`を送受信に使って通信を行う。

- ntpdate : 指定したNTPサーバーから現在時刻を取得するコマンド
- ntpq : NTPサーバーの状態を照会することができるコマンド

## ntpdate

NTPサーバーからシステムクロックへ時刻を同期する。

=> ハードウェアクロックに反映させる場合は`hwclock -w(--systohc)`

書式: ntpdate [オプション] NTPサーバー

```
ntpdate pool.ntp.org
```

## ntpd

NTPデーモン。指定したNTPサーバーに定期的に時刻情報を問い合わせて自身の時刻を修正し、正確なシステムクロックを維持する。

ntpdの各種設定は`/etc/ntpd.conf`で行う。

| 設定項目  | 説明                                         |
|-----------|----------------------------------------------|
| restrict  | ntpdへのアクセス制限を行う                   |
| server    | 時刻を取得するサーバーを指定                 |
| driftfile | 自身の時刻のズレ具合を記録するファイルを指定 |

## ntpq

ntpdの時刻同期状況を確認できるコマンド。

デフォルトでは対話モード(-iオプションと同じ)で起動する。

| オプション | 説明                                                                              |
|------------|-----------------------------------------------------------------------------------|
| -p         | serverに指定したサーバーとの同期状態を一覧表示(対話モードの`peers`コマンドと同じ) |
| -i         | 対話モードで起動する(デフォルト)                                                  |

`ntpq -p`で表示される項目:

| 項目   | 説明                                                                                                             |
|--------|------------------------------------------------------------------------------------------------------------------|
| remote | serverに指定したNTPサーバーのホスト。先頭に`*`が付いているものが時刻同期先。`+`は時刻同期可能。`-`は参照しない。 |
| refid  | remoteのサーバーの時刻参照先アドレス。同期開始時は`.INIT.`、stratum 1サーバーでは`.GPS.`などを表示               |
| st     | remoteのサーバーのstratum                                                                                        |

# Chrony

# timesatectl

