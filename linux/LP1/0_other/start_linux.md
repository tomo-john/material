# 1.Linuxの起動プロセス

1.1 BIOS/UEFI
- 電源ONの後、BIOS/UEFIが起動しハードウェアの初期化を行う
- ブートデバイス(HDDやSSD)を特定し、ブートローダを読込む

1.2 ブートローダ(例: GRUB)
- ブートローダはOSカーネルをメモリに読み込み、制御をOSに渡す
- GRUBがよく使われ、複数のカーネルやOSを選択できる機能を持っている

1.3 カーネル起動
- カーネルがロードされると、メモリ管理やデバイスドライバの初期化などが行われる
- カーネルはinitプロセス(PID1)を起動 → このinitがシステム管理を行う最初のプロセス

1.4 initプロセス(SysVinit)
- SysVinitは古くから使用されているinitシステムで、システムのランレベルを管理する
- `/etc/inittab`ファイルを読み、指定されたランレベルに応じたスクリプトを実行
- スクリプトは`/etc/rc.d/`や`/etc/init.d`に配置されている

# 2.SysVinitの仕組み

2.1 ランレベル

SysVinitはシステムを起動する際に、ランレベルを使用して異なる状態を管理する

ランレベルごとに起動するサービスが変わる

- 0: システム停止
- 1: シングルユーザーモード(メンテナンス用)
- 2: マルチユーザーモード(ネットワークなし)
- 3: マルチユーザーモード(ネットワークあり、GUIなし)
- 4: 未使用のカスタム用
- 5: マルチユーザーモード(GUIあり)
- 6: システム再起動

2.2 `/etc/inittab`ファイル

SysVinitでは`/etc/inittab`ファイルを読込んでどのランレベルでシステムを起動するかを決定する

```shell:/etc/inittab
id:3:initdefault:
```

2.3 initスクリプト

各ランレベルに関連するサービスの起動や停止は、`/etc/rc.d`や`/etc/init.d`にあるスクリプトによって管理される

ランレベルごとに`rcX.d`(Xはランレベル)ディレクトリがあり、`S`で始まるスクリプトがサービスを起動し、

`K`で始まるスクリプトがサービスを停止する

# 3.システムの停止・再起動
- システム停止はランレベル`0`、再起動はランレベル`6`
- `init 0`や`init6`のように`init`コマンドでランレベル変更が可能
- `shutdown`, `reboot`コマンドでも操作は可能

---

# systemd
`systemd`はSysVinitに代わる最新のinitシステムで、多くの現代的なLinuxディストリビューションで採用されている

systemdは単なるinitシステム以上のもので、システム全体の管理を行うためのツールセットでもある

## 1.systemdの特徴

1.1 並列起動
- 並列起動が可能で、起動時に複数のサービスを同時に開始できる
- これにより起動時間が大幅に短縮される

1.2 サービスの依存関係管理
- サービス間の依存関係を詳細に管理する
- あるサービスが起動する前に必要な別のサービスが確実に動作していることを保障する

1.3 ソケットとデーモンの管理
- ソケットベースの起動がサポートされている
- サービスが実際に使用されるタイミングでソケットを介して起動することが可能

1.4 ユニット(Unit)の概念
- サービス、マウントポイント、デバイス、タイマーなどをユニット(Unit)という形で定義する
- `*.service`, `*.mount`, `*.timer`などのファイルで定義され、設定が可能

1.5 ロギング機能
- journalを使用してログ管理機能が統合されている
- サービスやシステムのログを一元的に管理し、詳細な分析が可能
- `journalctl`コマンドで閲覧できる

## 2.systemdの起動プロセス
Linuxカーネルが起動した後、最初に起動されるプロセスがsystemd

systemdは、システムのさまざまなユニットを順次並列に起動し、システム稼働状態にする

2.1 ターゲット(Target)

SysVinitのランレベルに対応する概念が systemdでは`ターゲット(Target)`

ターゲットはシステムの特定の状態を表し、複数のユニットをまとめて管理する

2.2 ユニットファイル

systemdでは、すべてのサービスやプロセスはユニットファイルによって管理される

ユニットファイルは通常、`/etc/systemd/system`や`/lib/systemd/system/`に配置される

各ユニットファイルには、そのサービス設定が記述されている

## 3.systemctlコマンド

