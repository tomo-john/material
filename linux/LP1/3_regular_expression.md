# 正規表現(Regular Expression)
正規表現はシェルのメタキャラクタ同様、任意の文字列パターンを表すための表記方法

ファイル内の文字列を柔軟かつ強力に検索することができる

正規表現とシェルのメタキャラクタは同じ文字でも意味が異なるので注意が必要

主な正規表現
```
.  : 任意の一文字
*  : 直前の文字の0回以上の繰り返し
[] : []内の文字のいずれかの1文字(-: 範囲を指定 / ^: 先頭にあるときは「〜以外」を表す)
     [0-9]は数字, [a-z]はアルファベット小文字, [A-Z]は大文字, [a-zA-Z]で大文字小文字
^  : 行頭
$  : 行末
\  : 次にくる文字をメタキャラクタではなく通常の文字といて処理
```

いくつか例
```
# 1...1
1abc1, 12341, 10001, 1j011 など
.が3つなので3文字必要

# ab*z
az, abz, abbz など
0回以上の繰り返しなのでazもマッチする

# [^abc]d
dd, zd, Ad など
[^abc]でaでもbでもcでもない1文字

# ^a
a, abc, aaa, apple など
行頭にaがあるとマッチ

# xyz$
234xyz, aaxyz, JOHNxyz など
xyzで終わるとマッチ

# \.txt$
sample.txt, memo.txt など
.txtで終わるとマッチ(\で.を文字として認識)

# ^$
空白行(改行のみ)にマッチ
行頭と行末に何もないの意味
```

拡張正規表現
- grepコマンドに`-E`オプションをつけるか、`egrep`コマンドを使用しよう
```
+     : 直前の文字の1回以上の繰り返し
?     : 直前の文字の0回もしくは1回以上の繰り返し
|     : 左右いずれかの記述にマッチ
{n}   : 直前の文字のn回の繰り返し
{n,m} : 直前の文字のn回からm回の繰り返し
```

いくつか例
```
# a+b
ab, aab,aaaaaab など

# a?b
b, ab

# \s(22|53)/tcp
22/tcp, 53/tcp
\sはスペースを表す正規表現

# [a-z]{3}
abc, xyz, ppp, dog など
小文字アルファベット3文字

# [0-9]{3}-[0-9]{4,6}
123-4567, 777-00000, 654-224466 など
数字3桁に-、その後に数字が4桁or5桁or6桁
```

## grep
正規表現によって検索文字列があるかを調べることができる

```
grep [オプション] 検索パターン [ファイル名]

grep [オプション] [-f ファイル名] [ファイル名]
```

- -c: マッチした行の行数だけを表示
- -f: 検索パターンをファイルから読み込む
- -i: 大文字小文字を区別しない
- -n: 行番号も表示
- -v: マッチしない行を表示
- -E: 拡張正規表現を使用(egrep)

### fgrep
検索パターンに正規表現を使わない

```
# .* という文字列で検索(正規表現でない)
fgrep '.*' sample.txt

# grepで同じことするなら \ でエスケープ
grep '\.\*' sample.txt
```

## sed
Streme Editor

テキストストリートに対して編集を行う

編集する内容をコマンドやスクリプトで指示しておき、その指示に基づいて編集

=> 標準出力に編集結果を書き出す

```
sed [オプション] コマンド [ファイル]

sed [オプション] -e コマンド1 [-e コマンド2 ...] [ファイル]

sed [オプション] -f スクリプト [ファイル]
```

オプション
- -f ファイル: コマンドが書かれたスクリプトファイルを指定
- -i : 処理した内容でファイルを上書き

コマンド
- d: マッチした行を削除
- s: パターンに基づいて置換 => gスイッチを使うとマッチ箇所を全て置換
- y: 文字を変換

```
# fileの1から5行目を削除(file自体は変更しない)
sed '1,5d' file

# dogをsuper_dogへ置換(行の中で最初に見つかった箇所のみ)
sed 's/dog/super_dog/' file

# dogをsuper_dogへ置換(gスイッチで全ての一致箇所を置換)
sed 's/dog/super_dog/g' file

# 1から10行目までの先頭に > 記号を追加
sed '1,10s/^/>/' file

# A => 1, B => 2, C => 3 へ置換
sed 'y/ABC/123/' file
```

