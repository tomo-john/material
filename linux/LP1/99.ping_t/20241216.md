# systemdのマウント

手動で`mount`コマンドを実行すると、systemdがマウントを検知して、各マウントポイントと同名の「mount」ユニットを自動生成する。

その後もsystemdはマウントポイントや「mount」ユニットの状態を把握しながら監視を行う。

手動でのマウントは`/etc/fstab`に設定がないファイルシステムや、systemdがまだ認識していないファイルシステムに対しても実行可能。

# /var/log/dmesg

`/var/log/dmesg`は、システム起動時点のカーネルメッセージ(リングバッファの内容)が保存されるログファイル。

システムの起動障害を調査する際に役立つ。

/var/log/dmesgは、起動のたびに新しい内容で置き換えられる。

ファイルシステムによっては存在しない場合もある。

カーネルのリングバッファは、カーネルのログメッセージを一時的に保存する固定サイズのデータ領域。

マシンの再起動やシャットダウンによってリセットされる。

運用中は一杯になると古い情報から上書きされていく。

システム起動直後は、/var/log/dmesgとdmesgコマンドが表示する情報は同じ内容。

`dmesg --clear`コマンドはカーネルのリングバッファをクリアするが、/var/log/dmesgファイルの内容が変更されることはない。

リングバッファとログファイルは個別のもので、一方を手動でクリアしても、もう一方には影響を与えない。

# /etc/rc1.d/K01bluetooth

SysVinitでは、システムの起動時やランレベルの変更時にinitが`/etc/inittab`を参照し、

ランレベルに応じたスクリプトを実行して各種サービスを順に起動・停止していく。

各ランレベルに応じたスクリプトは`/etc/rc[0-6].d`に入っている。

例: `K01smartd`

- 1文字目: S(Start: サービスを起動)、K(Kill: サービスを停止)
- 数字: 実行優先順位。若番のものが先に実行される。
- サービス名: 任意の名前をつける

`/etc/rc1.d/K01bluetooth`はrc1.dディレクトリにあるスクリプトであり、`K`から始まるスクリプトなので

シングルユーザーモード(ランレベル1)のサービスを停止させるスクリプトであることがわかる。

# 環境変数 $USER

環境変数`$USER`はログインしているユーザー名を格納する環境変数。

# ランレベル/ブートターゲットの変更

システムを再起動させるいはいくつかの方法がある。

- rebootコマンドを実行する
- `init 6`または`telinit 6`コマンドを実行する
- shutdownコマンドを使用する(-rオプション)
- systemctlコマンドを使用する(systemdの場合のみ。サブコマンドはreboot)

systemctlのサブコマンド`start`にシステムの再起動を実行するターゲット`reboot.target`を指定することでも再起動が可能。

# Upstart

UpstartはSysVinitを改善した新しい仕組み。

Red Hat Enterprise Linux(RHEL)やUbuntuに採用されていたが現在はsystemdへの置き換えが進められている。

Upstartはバックグラウンドで動作するデーモンプロセス(サービス)や、一度だけ実行させたい処理(タスク)を`ジョブ`と呼び、

ジョブ単位で起動処理の管理を行う。

Upstartは各ジョブの実行に必要な前提条件を`イベント`で管理し、前提条件がすべて成立した時点でジョブを実行する。

SysVinitのように順次起動していくのと異なり、サービスの起動に必要な条件が成立した時点で起動処理が行われるため

不要な待機時間がなくなる。また、各ジョブの実行がパラレル(並列)に行われるため、関連のない独立したサービスを同時に起動が可能。

イベントはシステム上の変化を感知するだけでなく、`initctl`コマンドで発行することもできる。

# find

`-print`アクションでは検索結果を改行で区切って表示(デフォルト)

`-print0`では検索結果をNULL文字(\0)で区切って表示

```
find . -name "*.md" -print0
```

