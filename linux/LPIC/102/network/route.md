# route

ルーティングテーブルの表示や操作を行うコマンド。

- ルーティングテーブルの表示 : `route [オプション]`
- ルーティングテーブルに新たな経路を追加 : `route add [パラメータ]`
- ルーティングテーブルから経路情報を削除 : `route del [パラメータ]`

引数なしで実行するとルーティングテーブルが表示される。

=> `ntstat -r`コマンドと同じ

## ルーティングとは？

複数のネットワーク間でデータが正しく届くように、IPパケットが通過する経路(ルート)を制御すること。

=> そのための経路情報が記述された表が`ルーティングテーブル`。

## オプション

- -F : カーネルのルーティングテーブルを表示
- -C : カーネルのルーティングキャッシュを表示

## ルーティングテーブルの項目

| 項目        | 説明                                                                              |
|-------------|-----------------------------------------------------------------------------------|
| Destination | 宛先のネットワークもしくはホスト                                                  |
| Gateway     | ゲートウェイのアドレス(`*`は未設定)                                               |
| Genmask     | 宛先のサブネットマスク(ホストは255.255.255.0、デフォルトゲートウェイは0.0.0.0)    |
| Flags       | 経路状態( U: 経路が有効 / H: 宛先はホスト / G: ゲートウェイを使用 / !: 経路は無効 |
| Metric      | 宛先までの距離                                                                    |
| Ref         | ルートの参照数(不使用)                                                            |
| Use         | 経路の参照回数                                                                    |
| Iface       | この経路を使うネットワークインターフェース                                        |

## 設定例

```
# 192.168.1.0～192.168.1.254宛パケットは172.120.10.254に送られる
route add -net 192.168.1.0 netmask 255.255.255.0 gw 172.20.10.254
```

```
# デフォルトゲートウェイを172.20.10.1に設定
route add default gw 172.20.10.1
```
## パケット転送許可

Linuxをルーターとして利用する場合は、異なるネットワーク間のパケット転送を許可する必要がある。

`/proc/sys/net/ipv4/ip_forward`が`1`になっていることを確認する。

=> 0であれば1を書込む

=> `echo 1 > /proc/sys/net/ipv4/ip_forward`

---

# ip(コマンド)

ネットワークインターフェースやルーティングテーブル、ARPテーブルなどを管理するコマンド。

=> `route`, `ifconfig`コマンドを合わせたような働きをする

=> 昔は`route`,`ifconfig`を使用していたが今は`ip`コマンドが主流。

### 操作対象

| 操作対象 | 説明                 |
|----------|----------------------|
| ling     | データリンク層       |
| addr     | IPアドレス           |
| route    | ルーティングテーブル |

### サブコマンド

| サブコマンド | 説明                                               |
|--------------|----------------------------------------------------|
| show         | 表示(デフォルト: サブコマンドなしでshow指定と同じ) |
| add          | 設定                                               |

### 使用例

```
# インターフェース(NIC)の確認
ip link show
```

=> `eth0`などのインターフェース一覧が表示される

```
# IPアドレスの確認
ip addr show

# もしくは
ip a
```

=> 各インターフェースの割り当てられたIPアドレスが確認できる

