# 仮想化のゲストOSとしてのLinux

## 1 クラウドサービスとインスタンス

クラウドサービス上の仮想的なLinuxマシン `インスタンス` を利用することが一般的になってきている

物理サーバーよりも迅速にインフラ構築ができたり、容易にCPUやメモリ、ストレージを拡張できるのがメリット

クラウドサービスでは`IaaS`, `PaaS`, `SaaS`に構成要素を分類できる

### IaaS

Infrastructure as a Service

ネットワークからOSまでをサービスとして利用者に提供する形態

クラウドサービス者が管理する物理サーバー上で仮想マシンを起動

=> 利用者は仮想マシンを自由に扱う(ミドルウェアやアプリは必要に応じてインストール)

### PaaS

Platform as a Service

IaaSに加えてアプリケーションの実行環境まで提供される

開発環境、データベース、プログラミング言語の実行環境が提供されるので、すぐに開発できる

### SaaS

Software as a Service

アプリケーションそのものが提供される

従来はパッケージソフトウェアとして提供されていたものをインターネット上で提供するスタイル

自由度は低くなるが、利用者はすぐにアプリケーションを利用できる

### インスタンス

IaaS上で提供される個々の仮想マシンはインスタンス(instance)とも呼ばれる

インスタンスはソフトウェア的に構成されたコンピュータ

インストールはあらかじめ用意されたテンプレート(OSイメージ)から作成される

物理サーバーへのインストールに比べ、OSイメージから素早く作成することができる

### クラウドコンピューティングの主な用語

- `ブロックストレージ`: 仮想的なディスクストレージ(物理サーバーと異なり簡単に容量を追加できる)
- `ゲストOS`: 仮想マシンにインストールされたOS
- `OSイメージ`: インスタンスのテンプレートとなるディスクイメージ
- `インスタンス`: クラウド上で動作する個々の仮想マシン
- `コンテナ`: 独立したOSのように扱えるアプリケーション実行環境(仮想マシンより消費リソースが少なく軽量)
- `アプライアンスコンテナ`: 特定用途向けにあらかじめWebサーバーやDBが組み込まれたコンテナイメージ
- `ゲストドライバ`: 仮想マシンがホストマシン上のデバイスにアクセスする際などに使われるソフトウェア

## 2 インスタンスの初期化

テンプレートをコピーしただけでは、ホスト名やSSH鍵(ホストキー)が重複してしまう

これを解決する仕組みが`Cloud-init`

テンプレートとなるOSイメージにはCloud-initが組み込まれていて、インスタンス初回自動時に

設定(ユーザーデータ)に基づいて適切な設定が行われる

Cloud-initで設定できる主な項目
- ホスト名
- SSH公開鍵
- 一般ユーザー
- インストールするパッケージ

個々のインストールを識別するのに`D-BusマシンID`が利用できる

=> /etc/machine-id に格納されており、インスタンスごとに異なる値が割り当てられている

