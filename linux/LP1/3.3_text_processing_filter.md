# テキスト処理フィルタ

Linuxではテキストデータを加工するためのフィルタとなるコマンドが多数あり

Linux(Unix)システムのフィルタとは、ファイルやテキストデータを読み込んで

何かしらの処理を行って出力するプログラムのこと

## 1 テキストフィルタコマンド

### cat

ファイルの内容を標準出力に出力

=> シェルのリダイレクトで複数のフィアルを結合もできる

- -n: 行番号付加

```
# file1と2を結合してnew_fileへ
cat file1 file2 > new_file
```

### nl

テキストファイルに行番号をつけて表示

オプション
- -b 形式: 本文に行番号付加
- -h 形式: ヘッダに行番号付加
- -f 形式: フッタに行番号付加

形式
- a: すべての行
- t: 空白以外の行
- n: 行番号の付加を中止

### od

バイナリファイルを8進数(デフォルト)で表示

- -t 出力タイプ: 出力するフォーマットを指定

出力タイプ
- c: ASCII文字
- o: 8進数(デフォルト)
- x: 16進数

### cut

ファイルの各行から指定したフィールドを取り出す

オプション
- c 文字数: 取り出す文字位置を指定
- d 区切り文字: フィールドの区切り文字(デリミタ)を指定 => デフォルトはタブ
- f フィールド: 取り出すフィールドを指定

```
# 区切り文字を[:]として第6フィールドだけ取り出し
cut -d: -f 6 /etc/passwd
```

### paste

1つ以上のファイルを読み込み、行ごとに水平方向に連結

- -d: 区切り文字: 区切り文字を指定(デフォルトはタブ)
- -s: 各ファイルの行を縦に結合(行単位で結合)

### tr

標準入力から読み込まれた文字列を変換したり、削除したり

```
tr [オプション] [文字列1 [文字列2]]
```

オプション
- -d: 文字列1でマッチした文字列を削除
- -s: 連続するパターン文字列を1文字として処理
- -c: 指定した文字以外の文字を変換

クラス
- [:appha:]: 英字
- [:lower:]: 英小文字
- [:upper:]: 英大文字
- [:digit:]: 数字
- [:alnum:]: 英数字
- [:space:]: スペース

```
# 小文字を大文字へ変更 (HELLO WORLD)
echo "hello world" | tr 'a-z' 'A-Z' 
echo "hello world" | tr '[:lower:]' '[:upper:]'


# 文字の削除
echo "hello 123" | tr -d '0-9' # hello

# 連続文字の圧縮
echo "aaabbbccc" | tr -s 'a' # abbbccc

# 文字以外の変換
echo "abc123" | tr -c '0-9' 'X' # XXX123
```

### split

指定されたサイズでファイルを分割(デフォルトでは1000行ごと)

分割されたファイルは、ファイル名の末尾に`aa`, `ab`, `ac`...が付与

```
split [オプション] [入力ファイル名 [出力ファイル名]]
```

- -行数: 入力ファイルを行数ごとに分割

### uniq

重複行を1行にまとめて出力(sortされている必要あり)

```
sort file | uniq > out_file
```

### xargs

標準入力から受け取った文字列を引数に指定し、与えられたコマンドを実行

```
# 60日を超える日数の間更新されていないファイルを削除
find . -mtime +60 -type -f | xargs rm
```
findコマンドの実行結果を受け取って、rmコマンドの引数にそれを指定し実行している

以下のコマンドと同じ

```
find . -mtime +60 -type f -exec rm {} \;
```

## 2 ファイルのチェックサム

###  チェックサムとは？

ファイルやデータを基にして計算される数字

データの整合性を確認するための値

データのバイト列を特定のアルゴリズムで計算し、小さな値に変換する

アルゴリズムには`md5`, `sha1`, `sha256` などがよく使用される

### ハッシュ関数

ハッシュ関数を使うとファイルを一方的に暗号化し、一定の長さの文字列(ハッシュ値)にする

ハッシュ値はファイルサイズ大小にかかわらず同じ長さであり、元のファイルの少しの変更で

全体が大きく変化する(ファイルが改ざんされてたり破損していないかのチェックに使える)

ハッシュ値から元のデータを復元することはできない

## ハッシュ値を出力するコマンド

|コマンド  |説明                     |
|----------|-------------------------|
|md5sum    |MD5によるハッシュ値を出力|
|sha1sum   |SHA1                     |
|sha256sum |SHA256                   |
|sha512sum |SHA512                   |

### チェックサムアルゴリズム

- MD5: よく使用されるがセキュリティに弱い
- SHA1: MD5よりもセキュリティが強化されているが、最新の用途には弱い
- SHA256: 比較的新しい => セキュリティが強固

### -cオプション
チェックサムファイルを指定する

オープンソースのソフトウェアのダウンロードサイトなどにチェックサムファイルが搭載されていることがある

本体ファイルとチェックサムファイルを同じディレクトリにダウンロードし、拡張子に合わせてコマンドを実行

```
# 同じディレクトリ
ls
httpd-2.4.37.tar.bz2 httpd-2.4.37.tar.bz2.sha256

# -cオプション
sha256sum -c httpd-2.4.37.tar.bz2.sha256
httpd.2.3.37.tar.bz2: OK
```

