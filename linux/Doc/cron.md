# cron

`crond`デーモンによって指定されたスケジュールに基づいてコマンドを実行する。

ユーザーごとに専用のcrontabがあり、システム全体用の`/etc/crontab`も存在する。

- crontab : ユーザーごと => `crontab`コマンドで編集など
- /etc/crontab : システム全体 => root権限で直接編集(vimなどのエディタ)・書式にユーザー名が追加される

## crontabファイルの構成

```
# 分 時 日 月 曜日 コマンド
* * * * * cmd
```

## 書式

| フィールド | 値の範囲        | 説明                  |
|------------|-----------------|-----------------------|
| 分         | 0-59            | 実行する分            |
| 時         | 0-23            | 実行する時            |
| 日         | 1-31            | 実行する日(1ヶ月の日) |
| 月         | 1-12            | 実行する月            |
| 曜日       | 0-7(0と7は日曜) | 実行する曜日          |

- 複数指定: カンマ(`,`)で区切る
- 範囲指定: ハイフン(`-`)で範囲を指定
- ステップ: スラッシュ(`/`)でステップ値を指定
- 任意の値: アスタリスク(`*`)

## crontabの管理

```
crontab -l : 現在の内容を表示
crontab -e : 内容の編集
crontab -r : 削除(注意が必要)
```

## 例

例1: 毎日午前2時にバックアップスクリプトを実行

```
0 2 * * * /path/to/backup.sh
```

例2: 毎週月曜日の午前8時30分にログを削除

```
30 8 * * 1 rm -f /path/to/logs/*
```

例3: 5分おきに特定のスクリプトを実行

```
*/5 * * * * /path/to/script.sh
```

---

# 設定ファイル・ディレクトリ

| cron種別   | 設定ファイル・ディレクトリ | 内容                                                                  |
|------------|----------------------------|-----------------------------------------------------------------------|
| ユーザー用 | /var/spool/cron/ユーザー名 | ユーザー用設定ファイル                                                | 
| システム用 | /etc/crontab               | システム用設定ファイル(主に以下の4つのディレクトリのスクリプトを実行) | 
| システム用 | /etc/cron.hourly/          | 毎時実行するスクリプトを置く                                          | 
| システム用 | /etc/cron.daily/           | 毎日実行するスクリプトを置く                                          |
| システム用 | /etc/cron.weekly/          | 毎週実行するスクリプトを置く                                          | 
| システム用 | /etc/cron.monthly/         | 毎月実行するスクリプトを置く                                          |
| システム用 | /etc/cron.d/               | サービス個別のジョブ実行を定義した設定ファイルを置く                  |

- ユーザー用のcrontabファイルは`crontab`コマンドで編集
- システム用のcrontabファイルはvimなどの`エディタ`で編集
- ユーザー`john`のcrontabファイルなら`/var/spool/cron/john`

```
# /etc/crontabの例
01 * * * * root run-parts /etc/cron.hourly
```

これは`/etc/crontab`に書かれている典型的なシステムジョブの1つで、1時間ごとに`/etc/cron.hourly`にあるスクリプトを実行する設定。

- 毎曜日、毎月、毎日、すべての時間の毎時01分
- root : このコマンドはrootユーザーで実行される
- run-parts /etc/cron.hourly : このディレクトリ内のスクリプトを実行

### run-parts

指定したディレクトリ内のスクリプトを順番に実行するコマンド。

`/etc/cron.daily`, `/etc/cron.weekly`などの実行にも使われている。

