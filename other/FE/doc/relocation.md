# 再配置

コンパイルされたプログラムをメモリ上のどこにロードしても、正しく実行できるようにアドレスを調整する処理。

マルチタスク環境において、OSがプログラムをメモリの空いている任意の場所に配置するために不可欠な仕組み。

### 再配置が必要な理由

プログラムは通常、コンパイル時に、メモリの特定番地(例えば0番地)から始まることを前提としてアドレスが設定されている。

=> これを絶対アドレスと呼ぶ

しかし、実際にOSがプログラムを実行する際、その番地には既に別のプログラムやOS自身が使っているデータが格納されている場合がある。

もしプログラムが絶対アドレスのままロードされると、本来0番地を参照すべき命令がロードされた新しいアドレスを指さず正常に動作しない。

### 再配置の仕組み

再配置は、プログラム内のアドレスをロード時に修正することで、この問題を解決する。

- 1. 相対アドレスの使用:

  プログラム内のアドレス指定を、あらかじめ`先頭からの相対的な位置`として記述しておく。

  => データXは、プログラムの先頭から100番目の場所にある。みたいな

- 2. 再配置情報の保持:

 プログラム中のどこに絶対アドレス指定が使われているかという情報(再配置情報)をファイルに記録しておく。

 => コンパイラやリンカがプログラムをコンパイルする際に行う

- 3. ロード時のアドレス修正:

  プログラムがメモリにロードされる際、OSのローダが以下の処理を行う。

  - プログラムが実際にロードされた開始(基底)アドレスを特定
  - 再配置情報に従って、プログラム内のすべてのアドレス指定に、この基底アドレスを加算し修正

これにより、プログラムがメモリ上のどの位置にロードされても、そのプログラム内の正しいデータや命令にアクセスできるようになる。

