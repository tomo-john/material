# useradd

ユーザーアカウントを作成するコマンド。

Debian/GNU Linux, Ubuntuでは`adduser`コマンドの使用が可能。

```
useradd [オプション] ユーザー名
```

## オプション

| オプション        | 説明                                           |
|-------------------|------------------------------------------------|
| -c コメント       | コメントフィールドを指定                       |
| -d パス           | ホームディレクトリを指定                       |
| -g グループ名/GID | プライマリグループを指定                       |
| -G グループ名/GID | プライマリグループ以外に所属するグループを指定 |
| -s パス           | デフォルトのシェルを指定                       |
| -D                | デフォルトの設定値を表示、もしくは設定         |
| -m                | ホームディレクトリを自動的に作成する           |

=> Debian系などではユーザー作成してもホームディレクトリが自動的に作成されない(`-m`オプションでユーザー名と同じ名前でホームディレクトリが作成される)

```
user add -m -s /bin/bash -g staff -G dog,rabbit john
```

- `john`というユーザーが追加される
- `/home/john`が作成される(`-m`)
- ログインシェルは`/bin/bash`(`-s`)
- プライマリグループは`staff`(`-g`)
- 補助グループは`dog, rabbit, bear`(`-G`)

---

# /etc/skel

`/etc/skel`は新しくユーザーのホームディレクトリを作成するときのひな形(テンプレート)ディレクトリ。

ホームディレクトリ作成時に配布したいファイルなどを置いておくと、ユーザー作成時に新ホームディレクトリにコピーされる。

=> ファイルの所有者は新規作成したユーザーに変更される

---

# usermod

既存のユーザーアカウントを変更するコマンド。

=> `/etc/passwd`ファイルの該当フィールドを書き換えた場合と同じになる

## オプション

| オプション        | 説明                                           |
|-------------------|------------------------------------------------|
| -c コメント       | コメントフィールドを変更                       |
| -d パス           | ホームディレクトリを変更                       |
| -g グループ名/GID | プライマリグループを変更                       |
| -G グループ名/GID | プライマリグループ以外に所属するグループを変更 |
| -s パス           | デフォルトのシェルを変更                       |
| -L                | パスワードをロックして一時的に無効化する       |
| -U                | パスワードのロックを解除する

---

# userdel

ユーザーアカウントを削除するコマンド。

=> デフォルトでは削除したユーザーのホームディレクトリが残る

=> ホームディレクトリも削除する場合は`-r`オプションを使用する

---

# passwd(コマンド)

パスワードを変更するコマンド。

- 一般ユーザー : 自分のパスワードだけを変更できる
- root : 別のユーザーのパスワードを変更できる

## オプション

| オプション | 説明                                     |
|------------|------------------------------------------|
| -l         | パスワードをロックして一時的に無効化する |
| -u         | パスワードをロックを解除する             |

---

# 対話型ログインの禁止

対話型ログインを禁止するには、ログインシェルを`/bin/false`または`/sbin/nologin`に設定する。

- `/bin/false` : 実行後にすぐに終了ステータス`1(失敗)`を返すので実質的にログインを防ぐ
- `/sbin/nologin` : ログイン拒否専用の処理を行う

ログインシェルの変更は`usermod -s`や`chsh -s`で行う。

- `usermod -s` : 既存ユーザーのログインシェルの変更をするオプション(`-s`はuseraddでも使用可能)
- `chsh -s` : シェル変更専用のコマンド(change shellの略)

```
usermod -s /bin/false john
chsh -s /sbin/nologin john
```

