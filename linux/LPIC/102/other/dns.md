# DNS(名前解決関連)

DNS(Domain Name System)はドメイン名をIPアドレスに変換する仕組み。(IPアドレスからドメイン名も可能)

# 関連コマンド

- host
- dig
- nslookup
- getent

# /etc/resolv.conf

- `nameserver`の後にDNSサーバーのIPアドレスを指定
  - 標準では3つまでしか設定できない

- `search`の後にドメイン名検索リストを指定
  - 省略されうるドメイン名を列挙する
  - 最大で6つまで設定(標準では)

- `domain`の後に自サーバーの所属するドメイン名を指定
  - ホスト名のみ問合せの場合は同じドメインに所属するホストとみなされる
  - 自動的にドメイン名が追加される
  - domainとsearchはいずれか1つしか設定できない(最後に記述されたものが有効)


```
# /etc/resolve.conf
search dog1.domain dog2.domain rabbit.domain
nameserver 192.168.1.1
nameserver 192.168.1.2
nameserver 192.168.1.3
```

### 問い合わせ順序

- DNSサーバー192.168.1.1に最初に問い合わせる
- 応答がなければ、192.168.1.2に問合せ
- 応答がなければ、192.168.1.3に問合せ

=> `名前解決ができなければ`ではなく、`応答がなければ`次のDNSサーバーに問い合わせる

### 名前解決の対象がホスト名のみ(ドットを含まない)場合

- リスト1番目(dog1.domain)をホスト名につけて名前解決
- 上記失敗の場合、リストの2番目(dog2.domain)を追加して名前解決
- 上記失敗の場合、リストの3番目(rabbit.domain)を追加して名前解決
- search行のドメイン名リストすべてで失敗した場合、ホスト名のみで名前解決
- ホスト名のみでも失敗した場合、名前解決失敗とする

### 名前解決の対象がドメイン名付きと思われる(ドットが含まれている)場合

- そのままで名前解決
- 失敗した場合、リスト1番目(dog1.domain)を追加して名前解決
- 失敗した場合、リスト2番目(dog2.domain)を追加して名前解決
- 失敗した場合、リスト3番目(rabbit.domain)を追加して名前解決
- search行のドメイン名リストすべてで失敗した場合、名前解決に失敗とする

