# パーミッションの設定

## 所有者
ファイルやディレクトリを作成すると、作成したユーザーがその所有者として設定される

所有者のプライマリーグループがファイルやディレクトリのグループとして設定される

## アクセス権
アクセス権は所有者、所有グループ、その他のユーザーの3種類に設定があり、

読み取り可能、書き込み可能、実行可能の3種類がある

|権限       |表記 |数字 |
|-----------|-----|-----|
|読み取り権 |r    |4    |
|書き込み権 |w    |2    |
|実行権     |x    |1    |

```
ls -l
-rw-r--r--   1 john  staff    0  8 17 12:15 permission
```
`-rw-r--r--` を分解(左から順に1-3-3-3)

- `-`: ファイルなら`-`, ディレクトリなら`d`, リンクなら`l`
- `rw-` : 所有者のアクセス権(rw-なので読み取りと書き込み)
- `r--` : グループのアクセス権利(r--なので読み取りのみ)
- `r--` : その他ユーザーのアクセス権

アクセス権は数値でも表すことができrwxの権限がある数字を合計して表現する

- rwx: 7
- rw-: 6
- r-x: 5
- r--: 4
- -wx: 3
- -w-: 2
- --x: 1
- ---: 0

### chmod
アクセス権を変更するコマンド

`-R`オプションでディレクト以下にある全ファイルのアクセス権を変更

対象
- u: 所有者
- g: グループ
- o: その他ユーザー
- a: 全てのユーザー

操作
- +: 追加
- -: 削除
- =: 権限を指定

許可の種類
- r: 読み取り許可
- w: 書き込み許可
- x: 実行許可
- s: SUIDもしくはSGID
- t: スティッキービット

これからを組み合わせてアクセス権を変更するか数値を用いてアクセス権を変更する

```
# rw-r--r--(644)からrw-rw-rw-(666)へ
chmod go+w file

# rwxrwxrwx(777)からrxwrwx--x(771)へ
chmod o-rw file

# 数値でアクセス権を指定
chmod 644 file
```

### SUID / SGID
Set User IDは実行権利を持っているユーザーによってプログラムが実行された場合、

ファイルの所有者の権限で実行される(実行権が`s`)

```
ls -l `which su`
-rwsr-xr-x  1 root  wheel  121920  8  4 19:31 /usr/bin/su
```

数値で表現する場合は3桁のアクセス権に`4000`を加える(711 => 4711)

SUIDと同様にグループのアクセス権が適用できるように設定するのがSGID

グループのアクセス権が`s`になる

数値で表現する時は3桁+`2000`

### スティッキービット
その他のユーザーの実行権が`t`(ディレクトリに多い)

書き込み権限はあっても、自分以外のユーザーが所有するファイルを削除することができない

数値で表記する場合は、3桁+`1000`

```
find / -perm -1000 -type d 2>/dev/null
/Library/Fonts

ls -ld /Library/Fonts 
drwxrwxr-t  3 root  admin  96  8  4 19:31 /Library/Fonts
```

### デフォルトのアクセス権
ファイルやディレクトリを作成した時に設定されるアクセス権は`umask値`で決定される

ファイルは`666`から、ディレクトリは`777`からumask値を引いた値がデフォルトのアクセス権

`umask`コマンドでumask値の設定や確認ができる

```
umask
022
```
- ファイルを作成した時のアクセス権は`644`(666 - 022)
- ディレクトリを作成した時のアクセス権は`755`(777 - 022)

