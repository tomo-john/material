# パイプとリダイレクト

## 1 標準入出力

データの入出力に伴うデータの流れのことを`ストリーム`という

| 番号 | 入出力名       | デフォルト |
|------|----------------|------------|
| 0    | 標準入力       | キーボード |
| 1    | 標準出力       | 画面(端末) |
| 2    | 標準エラー出力 | 画面(端末) |

## 2 パイプ

コマンドの出力結果を別のコマンドやプログラムの入力に渡すことができる

=> `|` でコマンドの標準出力を次のコマンドの標準入力へ渡す

```
# lsの結果をwcへ渡す
ls | wc -l
```

lsコマンドの実行結果(標準出力)をwcコマンドの標準入力に渡している

wcコマンドは引数がない場合、標準入力からのストリームを処理する

カレントディレクトリのファイルやディレクトリ名がlsコマンドによって出力され、それを受けてwcコマンドが行数をカウントする

=> カレントディレクトリ内のファイルおよびディレクトリの数をカウントすることとなる

### teeコマンド

コマンドの実行結果をファイルに保存するとともに画面上にも表示する

teeコマンドは標準入力から読み込み、それをファイルと標準出力へとT字型に分岐させる

=> 実行結果をファイルに書き込みつつ、次のコマンドへと実行結果を渡すことができる

```
# lsの結果をlogに書き込むとともにwcコマンドに渡す
ls -l | tee ls.log | wc -l
```

`-a`オプションでファイルに上書きするのではなく追記する

## 3 リダイレクト

コマンドの実行結果は、通常は画面上(端末上)に表示される

コマンドへの入力には、通常はキーボードが使用される

実行結果を画面ではなくファイルに保存したい場合や、

コマンドへの入力にあらかじめ用意していたファイルを使う場合に役立つのがリダイレクト(リダイレクション)

リダイレクトではコマンドへの入力元や出力先をコントロールする

| 記号          | 内容                                                                 | 例                                   |
|---------------|----------------------------------------------------------------------|--------------------------------------|
| `>`           | 標準出力をファイルに書き込む                                         | `echo "Hello, World!" > output.txt`  |
| `>>`          | 標準出力をファイルに追記する                                         | `echo "Hello again!" >> output.txt`  |
| `<`           | コマンドの標準入力をファイルから読み込む                             | `cat < input.txt`                    |
| `2>`          | 標準エラー出力をファイルに書き込む                                   | `command 2> error.log`               |
| `2>>`         | 標準エラー出力をファイルに追記する                                   | `command 2>> error.log`              |
| `&>`          | 標準出力と標準エラー出力の両方を同じファイルに書き込む               | `command &> output.log`              |
| `> file 2>&1` | 標準出力をファイルに書き込み、標準エラー出力をそのファイルに追記する | `command > output.log 2>&1`          |

```
ls -l > list
```

`ls -l`の結果を画面には出力せずファイル`list`に書込む

`list`ファイルが存在しない場合は新規作成し、存在する場合は内容を上書きする

```
ls -l >> list
```

ファイルの内容を上書きせず、既存ファイルの末尾に追加する場合は、`>>`を使用する

```
grep "dog" < animal.txt > result
```

`grep`コマンドへの入力を`animal.txt`とし、その実行結果をファイル`result`に書込んでいる

```
cat <<EOF > animal.list
dog
rabit
bear
EOF
```

特定の文字列が現れるまで入力を続けるには、リダイレクト記号の`<<`を使用し、これを`ヒアドキュメント`と呼ばれる

=> この例では終了文字を`EOF`を指定し、EOFの箇所までの内容が入力される

=> dog, rabbit, bearが`cat`コマンドに入力され、その出力が`animal.list`に書込まれる

`cat <<EOF > animal.list`は`cat > animal.list <<EOF`としても同じ

`<<`と`EOF`の間にスペースをいれてはいけないことに注意

```
find / -name "*.tmp" 2> error.lgo
```

標準エラー出力をリダイレクトするときは、リダイレクト記号の`2>`を使用する

=> エラー出力のみをファイルに保存し、後で確認するときに便利

```
ls > /dev/null 2>&1
```

`/dev/null`は特殊なファイルで、入力されたすべてのデータを消し去る

この例では`ls`コマンドの出力はいっさい画面に表示されない

=> 他のコマンドでもコマンドが出力するメッセージは画面上に表示されない


