# journalctl

systemd採用のシステムでは`journalctl`コマンドでsystemdのログ(ジャーナル)を閲覧できる。

引数なしで実行するとlessなどのページャで1ページごとにログが表示される。

### オプション

| オプション        | 説明                                                                         |
|-------------------|------------------------------------------------------------------------------|
| -b(--boot)        | ブート時のメッセージを表示                                                   |
| -D(--directory)   | 指定したディレクトリのログを表示                                             |
| -e                | ジャーナルの末尾(最新)を表示                                                 |
| -f(--follow)      | ログの末尾を表示しつづける                                                   |
| --full            | エスケープ文字を除いてプレーンテキストで出力                                 |
| -k(--dmesg)       | カーネルメッセージのみを表示                                                 |
| -l(--full)        | 画面表示可能なすべてのログを表示                                             |
| -n(--lines)       | 直近ログから指定した行数表示(デフォルトは10行)                               |
| --no-pager        | デフォルト使われるlessコマンドを使用しない                                   |
| -o(--output)      | ログの出力形式を指定                                                         |
| -p                | 指定したプライオリティよりも高いメッセージを表示                             |
| -r                | ログを新しい順に表示する(デフォルトは古いものから)                           |
| --since           | 指定した日付時刻以降のログを表示                                             |
| -u(--unit)        | 指定したUnitのログを出力する                                                 |
| --until           | 指定した日付時刻以降のログを表示                                             |
| --vaccum-size=    | アーカイブジャーナルの総容量が指定したサイズを下回るまで古いジャーナルを削除 |
| --vaccum-time=    | 指定した期間より古いアーカイブジャーナルを削除                               |
| -x                | 説明文付きで表示                                                             |

### 検索条件指定

| 検索キー       | 説明                             |
|----------------|----------------------------------|
| `_PID=`        | プロセス番号の指定               |
| `_UID=`        | ユーザーIDの指定                 |
| `_SYSTEM_UNIT` | Unit名の指定(-uオプションと同じ) |

ログが保存されているのは`/var/log/journal`や`/var/run/log/journal`などのディレクトリ内にあるバイナリファイル。(`system.journal`ファイル)

=> バイナリファイルなので、`cat`や`less`コマンドで直接見れない

---

# systemd-journald

systemdでは`systemd-journald`デーモンを動作させログの一元管理を行う。

systemd-journaldはsystemdから起動したプロセスの標準出力やsyslogへのログメッセージをバイナリ形式で記録する。

syslogの規格にも対応しており、同じファシリティやプライオリティが指定できる。

systemd-journaldのデフォルトの設定では、バイナリ形式のログは`/run/log/journal`配下にシステム固有のディレクトリを作成し、その中の`system.journal`というファイルに記録する。

=> `/run`ディレクトリはメモリ上に作成されたファイルシステム上のディレクトリのため、再起動するとデータは消える

ログが再起動でクリアされないようにするためには、`/etc/systemd/journald.conf`ファイルでジャーナルファイルの保存先を設定する。

=> `Storage=persistent`を設定 => `/var/log/journal`ディレクトリを作成し、その配下にログを吐く

設定変更時はsystemd-journaldの再起動が必要。

```
systemctl restart systemd-journald
```

