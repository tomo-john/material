# SysVinit

Linuxが電源を入れてから起動する手順

現在では`systemd` という新しい起動の仕組みが主流にもなってきている

## 1 SysVinitによる起動

最初に実行されるinitプロセスが`/etc/inittab`ファイルの設定に従い、必要なサービスを順次起動していく

① initが`/etc/inittab`ファイルを読み込む

② initが`/etc/rc.sysinit`スクリプトを読み込む

③ initが`/etc/rc`スクリプトを実行する

④ /etc/rcスクリプトが `/etc/rc<ランレベル>.d` ディレクトリ以下のスクリプトを実行する

あらかじめ決められた順にサービスが起動していくため、あるサービスの起動に手間取ると

それ以降に移動するサービスが待ち状態になり、起動完了までの時間がかかってしまう

## 2 ランレベル 

SysVinitではランレベルと呼ばれるいくつかの動作モードがある

ランレベルごとにどのようなサービスが稼働するか(もしくはしないか)を決定できる

|ランレベル|Red Hat Enterprise Linux, CentOS                    |Ubuntu, Debian GNU/Linux|
|----------|----------------------------------------------------|------------------------|
|0         |停止                                                |停止                    |
|1         |シングルユーザー      　　　                        |シングルユーザー　　　  |
|2         |マルチユーザー(テキストログイン・NFSサーバーは停止) |マルチユーザー          |
|3         |マルチユーザー(テキストログイン)                    |マルチユーザー          |
|4         |未使用                                              |マルチユーザー          |
|5         |マルチユーザー(グラフィカルログイン)                |マルチユーザ            |
|6         |再起動                                              |再起動                  |
|S or s    |シングルユーザー                                    |シングルユーザー        |

シングルユーザーモード: rootだけが利用できる状態(一般ユーザーはログインできない)

## 3 ランレベルの確認と変更

現在のランレベルを表示するには `runlevel` コマンドを使用する

```
runlevle # => N 5
```
現在のランレベルは5で、その前のランレベルはN(Nはランレベルを切り替えていない)

ランレベルを変更するにはrootにて `init` もしくは `telinit` コマンドを使用する

```
# 指定したメッセージを端末に送る
wall `Please logout!`

# ランレベルを1に変更
init 1
```

## 3 起動スクリプトによるサービスの管理

SysVinitでは各種サービスの起動には `/etc/init.d` ディレクトリ以下の起動スクリプトが使用される

=> ランレベルが異なれば起動されるサービスが異なる

`/etc/rc<ランレベル>.d` ディレクトリに各ランレベルで起動するサービス、終了するサービスのスクリプトファイルが配置

=> /etc/rc3.d/以下にはランレベル3になったときに利用されるスクリプトファイルがある

```
# httpdサービスを起動
/etc/init.d/httpd start

# httpdサービスを終了
/etc/init.d/httpd stop
```

## 4 デフォルトのランレベル設定

デフォルトのランレベルは `/etc/inittab` に記述されている

`id:5:initdefault:` の5の箇所の数値を変更するとデフォルトのランレベルが変更できる

=> 0や6は指定しないこと！

