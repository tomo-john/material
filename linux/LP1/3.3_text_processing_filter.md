# テキスト処理フィルタ

Linuxではテキストデータを加工するためのフィルタとなるコマンドが多数あり

Linux(Unix)システムのフィルタとは、ファイルやテキストデータを読み込んで

何かしらの処理を行って出力するプログラムのこと

## 1 テキストフィルタコマンド

### cat

ファイルの内容を標準出力に出力

=> シェルのリダイレクトで複数のファイルを結合もできる

```
cat [ファイル名]
```

| オプション | 説明       |
|------------|------------|
| -n         | 行番号付加 |

```
# file1と2を結合してnew_fileへ
cat file1 file2 > new_file
```

引数を省略した場合、標準入力からの入力を受け付けるようになる

### nl

テキストファイルの一部または全部に行番号をつけて表示

```
nl [オプション] [ファイル名]
```

| オプション | 説明                               |
|------------|------------------------------------|
| -b 形式    | 指定した形式で本文に行番号を付加   |
| -h 形式    | 指定した形式でヘッダに行番号を付加 |
| -f 形式    | 指定した形式でフッタに行番号を付加 |

| 形式 | 説明               |
|------|--------------------|
| a    | すべての行         |
| t    | 空白以外の行       |
| n    | 行番号の付加を中止 |

### od

バイナリファイルを8進数(デフォルト)や16進数で表示

```
od [オプション] [ファイル名]
```

| オプション    | 説明                       |
|---------------|----------------------------|
| -t 出力タイプ | 出力するフォーマットを指定 |

| 出力タイプ | 説明              |
|------------|-------------------|
| c          | ASCII文字         |
| o          | 8進数(デフォルト) |
| x          | 16進数            |

```
# 8進数で表示
od /etc/localtime

# 16進数で表示
od -t x /etc/localtime

# ASCII文字で表示
od -t c /etc/localtime
```

### head

ファイルの先頭部分を表示

オプションを指定しない場合は先頭から10行目まで表示

```
head [オプション] [ファイル名]
```

| オプション  | 説明                                     |
|-------------|------------------------------------------|
| -n 行数     | 先頭から指定された行数分だけ表示         |
| -行数       | 先頭から指定された行数分だけ表示(非推奨) |
| -c バイト数 | 出力するバイト数を指定                   |

### tail

ファイルの末尾部分を表示

オプションを指定しない場合は先頭から10行目まで表示

```
tail [オプション] [ファイル名]
```

| オプション  | 説明                                       |
|-------------|--------------------------------------------|
| -n 行数     | 先頭から指定された行数分だけ表示           |
| -行数       | 先頭から指定された行数分だけ表示(非推奨)   |
| -c バイト数 | 出力するバイト数を指定                     |
| -f          | ファイルの末尾に追加された行を表示し続ける |

`-f`オプションではファイルの末尾を表示し続け、ファイルの末尾に行が追加されるとリアルタイムで表示する

=> ログファイルをリアルタイムで監視するときなどに便利

### cut

ファイルの各行から指定したフィールドを取り出す

```
cut [オプション] [ファイル名]
```

| オプション    | 説明                                                       |
|---------------|------------------------------------------------------------|
| -c 文字数     | 取り出す文字位置を指定                                     |
| -d 区切り文字 | フィールドの区切り文字(デリミタ)を指定 => デフォルトはタブ |
| -f フィールド | 取り出すフィールドを指定                                   |

```
# ファイルの各行から5文字目(だけ)を取り出す
cut -c 5 sample.txt

# ファイルから各行の1～7文字目を取り出す
cut -c 1-7 sample.txt

# 区切り文字を[:]として第6フィールドだけ取り出し
cut -d: -f 6 /etc/passwd
```

### paste

1つ以上のファイルを読み込み、行ごとに水平方向に連結

=> 連結するときの区切り文字はデフォルトではタブ

```
paste [オプション] ファイル名1 ファイル名2 ...
```
| オプション    | 説明                                   |
|---------------|----------------------------------------|
| -d 区切り文字 | 区切り文字を指定(デフォルトはタブ)     |
| -s            | 各ファイルの行を縦に結合(行単位で結合) |

```
cat sample1.txt
aaa
bbb

cat sample2.txt
AAA
BBB

paste -d ":" sample1.txt sample2.txt
aaa:AAA
bbb:BBB
```

### tr

標準入力から読み込まれた文字列を変換したり、削除したりする

```
tr [オプション] [文字列1 [文字列2]]
```

| オプション | 説明                                    |
|------------|-----------------------------------------|
| -d         | 文字列1でマッチした文字列を削除         |
| -s         | 連続するパターン文字列を1文字として処理 |
| -c         | 指定した文字以外の文字を変換            |

| クラス    | 説明     |
|-----------|----------|
| [:appha:] | 英字     |
| [:lower:] | 英小文字 |
| [:upper:] | 英大文字 |
| [:digit:] | 数字     |
| [:alnum:] | 英数字   |
| [:space:] | スペース |

```
# 小文字を大文字へ変更 (HELLO WORLD)
echo "hello world" | tr 'a-z' 'A-Z' 
echo "hello world" | tr '[:lower:]' '[:upper:]'

# 文字の削除
echo "hello 123" | tr -d '0-9' # => hello

# 連続文字の圧縮
echo "aaabbbccc" | tr -s 'a' # => abbbccc

# 文字以外の変換
echo "abc123" | tr -c '0-9' 'X' # => XXX123
```

### sort

行単位でファイルの内容をソート(デフォルトでは昇順にソート)

```
sort [オプション] [+開始位置 [-終了位置]] [ファイル名]
```

| オプション | 説明                                 |
|------------|--------------------------------------|
| -b         | 行頭の空白は無視する                 |
| -f         | 大文字小文字の区別を無視する         |
| -r         | 降順にソート                         |
| -n         | 数字を文字ではなく数値として処理する |

### split

指定されたサイズでファイルを分割(デフォルトでは1000行ごと)

分割されたファイルは、ファイル名の末尾に`aa`, `ab`, `ac`...が付与

```
split [オプション] [入力ファイル名 [出力ファイル名]]
```

- -行数: 入力ファイルを行数ごとに分割

### uniq

重複行を1行にまとめて出力(sortされている必要あり)

```
sort file | uniq > out_file
```

### xargs

標準入力から受け取った文字列を引数に指定し、与えられたコマンドを実行

```
# 60日を超える日数の間更新されていないファイルを削除
find . -mtime +60 -type -f | xargs rm
```
findコマンドの実行結果を受け取って、rmコマンドの引数にそれを指定し実行している

以下のコマンドと同じ

```
find . -mtime +60 -type f -exec rm {} \;
```

## 2 ファイルのチェックサム

###  チェックサムとは？

ファイルやデータを基にして計算される数字

データの整合性を確認するための値

データのバイト列を特定のアルゴリズムで計算し、小さな値に変換する

アルゴリズムには`md5`, `sha1`, `sha256` などがよく使用される

### ハッシュ関数

ハッシュ関数を使うとファイルを一方的に暗号化し、一定の長さの文字列(ハッシュ値)にする

ハッシュ値はファイルサイズ大小にかかわらず同じ長さであり、元のファイルの少しの変更で

全体が大きく変化する(ファイルが改ざんされてたり破損していないかのチェックに使える)

ハッシュ値から元のデータを復元することはできない

## ハッシュ値を出力するコマンド

|コマンド  |説明                     |
|----------|-------------------------|
|md5sum    |MD5によるハッシュ値を出力|
|sha1sum   |SHA1                     |
|sha256sum |SHA256                   |
|sha512sum |SHA512                   |

### チェックサムアルゴリズム

- MD5: よく使用されるがセキュリティに弱い
- SHA1: MD5よりもセキュリティが強化されているが、最新の用途には弱い
- SHA256: 比較的新しい => セキュリティが強固

### -cオプション
チェックサムファイルを指定する

オープンソースのソフトウェアのダウンロードサイトなどにチェックサムファイルが搭載されていることがある

本体ファイルとチェックサムファイルを同じディレクトリにダウンロードし、拡張子に合わせてコマンドを実行

```
# 同じディレクトリ
ls
httpd-2.4.37.tar.bz2 httpd-2.4.37.tar.bz2.sha256

# -cオプション
sha256sum -c httpd-2.4.37.tar.bz2.sha256
httpd.2.3.37.tar.bz2: OK
```

