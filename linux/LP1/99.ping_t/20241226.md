# GRUB2

GRUB2の設定ファイルは`/boot/grub/grub.cfg`。

このファイルは直接編集することはなく、設定内容は`/etc/default/grub`ファイルおよび`/etc/grub.d`ディレクトリ内のファイルに記述し、

`grub-mkconfig`コマンドで設定内容を`/boot/grub/grub.cdg`ファイルに反映させる。

カーネルイメージ、ルートパーティションの指定などは`/etc/grub.d`ディレクトリ内のファイルで行う。

`insmod`にはロードするモジュールを指定する。GRUB2では機能ごとに用意されたモジュールを動的にロードできる。

モジュールファイルは通常`/boot/grub/i386-pc/`や`/boot/grub/x86_64-efi`に`XX.mod`の形式で格納されている。

insmodには`.mod`を除いた形式で指定する。(例: gzio.modを指定 => insmod gzio)

# cloud-init

IaaS(Infrastructure as a Service)はサーバー、ストレージ、ネットワークなど、仮想化されたインフラ環境をサービスとして提供する。

サーバーの仮想化技術と関連が深いサービスモデル。

IaaSは、クラウドサービス側ではハイパーバイザー型の仮想化環境を提供し、ユーザーはインスタンスと呼ばれる仮想マシンにOSをインストールし利用する。

クラウド上のインスタンスはテンプレートから展開されるため、テンプレートから複製された環境を重複しないように、インスタンスごとに変更する必要がある。

この作業をまとめて行う`cloud-init`というパッケージが用意されている。(クラウド上でなくてもインストールして使用できる)

# 拡張正規表現

拡張正規表現を使用するにはgrepコマンドに`-E`オプションをつけるか`egrep`コマンドを使用する。

| 記号 | 説明                               | 使用例                                       |
|------|------------------------------------|----------------------------------------------|
| `+`  | 直前文字の1回以上の繰り返し        | `a+`: aを1回以上繰り返す文字列(a, aa, aaaaa) |
| `?`  | 直前文字の0回もしくは1回の繰り返し | `jo?hn`: johnのoが0または1文字(jhn, john)    |
| `|`  | 左右いずれかの文字列               | `abc|xyz: abcまたはxyz                       |

# 正規表現の[]

[]内のいずれか1文字を意味する。

[]内では以下の表現と併用が可能。

- `-`: 範囲指定
- `^`: 先頭にある場合は後続の文字以外(否定)

[abc]: abcのどれか1文字

[a-z]: 小文字のアルファベット1文字

[^abc] : abc以外のどれか1文字

### [john|pypn] と john|pypn の違い

`|`は拡張正規表現で左右いずれかの文字列を意味する。

`[john|pyon]`では、`j, o, h, o`もしくは`p, y, o, n`を含むという意味になるが、

`john|pyon`では`john`もしくは`pyon`を含むという意味になる。

# fsck

ファイルシステムのチェック、および問題を修復することができるコマンド。

```
fsck [オプション] デバイス名
```

| オプション                | 説明                                                     |
|---------------------------|----------------------------------------------------------|
| -t ファイルシステムの種類 | ファイルシステムの種類を指定                             |
| -A                        | /etc/fstabに記述されている全フィアルシステムに対して実行 |
| -N                        | 実際には実行せず、実行する内容を表示                     |
| -a                        | 問題を自動的に修復                                       |
| -r                        | 問題を対話的に修復                                       |

```
# ext3ファイルシステムの/dev/sda4の整合性をチェックし、障害箇所を対話的に修復
fsck -r -t ext3 /dev/sda4
```

