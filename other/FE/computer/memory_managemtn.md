# 記憶管理

- 主記憶管理
- 仮想記憶管理

## 仮想記憶とは？

補助記憶装置の一部をあたかも主記憶装置の一部であるかのように扱う方式。

プログラムが主記憶装置の容量を超える大きさの場合に、そのプログラムを仮想記憶上に格納することで実行できるようになる。

仮想記憶管理では、OSが論理的な記憶領域を作る => これが仮想記憶。

主記憶装置上の物理的な記憶量機のことを実記憶という。

仮想記憶では、セグメンテーション方式と、ページング方式の2つの方式に分類される。

- セグメンテーション : 仮想記憶と実記憶をセグメントと呼ぶ可変長の領域に分割して管理
- ページング : 仮想記憶と実記憶をページと呼ぶ`固定長`の領域に分割して管理

## ページング方式

仮想記憶と実記憶の各ページには先頭から順にアドレスが割り振られる。

- 仮想アドレス : 仮想記憶のアドレス
- 物理アドレス : 実記憶のアドレス

仮想アドレスと物理アドレスは、`ページテーブル`と呼ばれる表によって対応付けられる。

仮想記憶の核ページと、ページテーブルの各行は1対1で対応づけられるため、仮想記憶にあるページ総数とページテーブルの行は同じ数になる。

仮想アドレス1にアクセス => ページテーブルの仮想アドレス1にある物理アクセスが2 => 実記憶の物理アドレス2にアクセスする流れ。

このとき、必要なページが実記憶(上の流れだと物理アドレス2)に存在しない場合、`ページフォールト`という割り込みが発生する。

この割り込みが発生すると、OSは必要なページを補助記憶装置から実記憶へ読み込む。これが`ページイン`。

一方で、実記憶に空きページがない場合、実記憶から外すページを1つ選び、それを実記憶から補助記憶装置へ書き出す。これが`ページアウト`。

ページインやページアウトはできるだけ発生しない方がCPUを効率よく使用できる。

なので、頻繁に使用するページを実記憶に残しておき、あまり使用しないページを実記憶から外すことが重要。

実記憶の容量が小さいと、ページインとページアウトが頻繁に起こる現象が起きる。これが`スラッシング`。

=> スラッシングが発生するとコンピュータ全体のスループットは低下する

## ページ置き換えのアルゴリズム

- LRU(Least Recently Used) : 最後に参照されて、最も長い時間が経過したページを置き換える
- LFU(Least Frequently Used) : 参照頻度が最も少ないページを置き換える
- FIFO(First In First Out) : 読み込んで最も長い時間が経過したページを置き換える(先入先出)

