# TCP Wapper

ネットワークのアクセス制御を集中的に行う。

- デーモン : `tcpd`

`tcpdデーモン`はtelnetdやftpdなどのサーバープログラムに代わり、設定に基づいてチェックを行い、接続が許可された場合はそれぞれのサーバープログラムに処理を引き渡す。

設定ファイル:

- /etc/hosts.allow : 許可
- /etc/hosts.deby : 拒否

tcpdはこの2つのファイルを調べて、サービス要求を許可するか拒否するかを決定する。

=> 最初に`/etc/hosts.allow`をチェック、次に`/etc/hosts.deny`の順

書式:

```
サービス名 : 対象ホストのリスト
```

=> サービス名には`sshd`などのデーモンプロセス名を、対象ホストにはホスト名、ドメイン名、IPアドレスの範囲を記述

=> 設定では下記のワイルドカード指定も可能

| ワイルドカード | 説明                                                                                                         |
|----------------|--------------------------------------------------------------------------------------------------------------|
| ALL            | すべてのサービスまたはホスト                                                                                 |
| A EXCEPT B     | B以外のA                                                                                                     |
| LOCAL          | `.`を含まないすべてのホスト(ローカルネットワークセグメント内のホスト)                                        |
| PARANOID       | クライアントのIPアドレスから逆引きしたホスト名と、そのホスト名を正引きしたIPアドレスが一致することを確認する |

設定例:

```
# /etc/hosts.allow

sshd: .lpic.jp
ALL: 192.168.2.
```

- lpic.jpドメインからのSSHアクセスを許可
- 192.168.2.0/24のネットワーク内からのアクセスをすべて許可

```
# /etc/hosts.deny

ALL: ALL
```

- すべてのホストからすべてのサービスへのアクセスを禁止

`/etc/hosts.allow`の設定が`/etc/hosts.deny`の設定より先に評価されるため、`/etc/hosts/deny`ですべてのアクセスを禁止し、`/etc/hosts.allow`に許可対象を記述するのが一般的。

`/etc/hosts/allow`, `/etc/hosts/deny`ファイルを変更するとシステムやネットワークの再起動``なし`でも変更は有効になる。

### 対応しているサービス

TCP Wrapperライブラリである`libwrap`を利用しているアプリケーションは`tcpd`なしでもTCP Wapperの機能を利用できる。

=> `sshd`, `vsftpd`, `xinetd経由サービス`, `telnetd`など

