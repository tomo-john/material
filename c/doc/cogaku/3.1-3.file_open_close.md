# ファイルのオープンとクローズ

## 1.ファイルのオープン
ファイルオープンには`fopenn`という関数を使用する

`FILE *fopen(char *ファイル名, char *オープンモード);`という定義がされていて下記のように使用する

```c
FILE *fp;
fp = fopen("TEST.DAT", "r");
```

fopenは指定されたファイル名のファイルを指定されたオープンモードでオープンする

ファイル名、オープンモードともに文字列であれば変数の利用も可能

ファイル名は絶対パス、相対パスのどちらの指定でもOK

オープンモードは読み書きなどのアクセス方法とファイルの種類の指定を行う

オープンや新規作成に成功するとファイルポインタにセットするアドレスが返ってくる

=> 失敗すると`NULL`が返ってくる

## 2.ファイルのクローズ
ファイルクローズには`fclose`関数を使用する

`int fclose(FILE *ファイルポインタ);`という定義がされており下記のように使用

```c
nrtn = fclose(fp1);
```

fcloseは指定されたファイルポインタに定義されているファイルをクローズする

このとき、ファイルバッファと呼ばれるキャッシュのフラッシュを行う

ファイルバッファはファイル入出力を高速化するための一時保管用メモリ領域

=> ファイルオープン時に自動的に割り当てられる

フラッシュとは、ファイルバッファに残っているデータを書き出すことをいう

=> フラッシュの後、ファイルバッファはメモリから解放される

- ファイルポインタはfopen時に返されるファイルポインタ変数を指定

- リターンはクローズが成功すると0, 失敗するとEOFが返ってくる

プログラム終了時は基本的にオープンしているファイルは自動的にクローズされる

=> プログラムがエラーなどで中断された場合はクローズせず、ファイルバッファが解放されない場合もある

```c
#include <stdio.h>

int main(){
  FILE *fp;
  char szfname[] = "ky101.dat";

  fp = fopen(szfname, "r");
  if(fp == NULL){
    fp = fopen(szfname, "w");
    if(fp == NULL)
      printf("ファイルの作成に失敗しました\n");
    else
      printf("ファイルを作成しました\n");
  }
  else
    printf("ファイルが存在します\n");
  fclose(fp);
}
```

