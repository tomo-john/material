# 主記憶装置(メモリー)

主記憶装置とは、命令やデータを格納しておく装置。

主記憶装置の内部は細かく区分けされており、各区画にアドレスが割り振られている。

CPUは、アドレスを指定して主記憶装置から命令やデータを取り出す。

## 命令の構成

主記憶装置からCPUに読込まれる命令は、`命令部`と`アドレス部`で構成されている。

- 命令部 : 命令の内容が格納(xxしなさいなど)
- アドレス部 : 処理対象のデータが格納されているアドレスが記載

## レジスタ

主記憶装置から読込まれた命令やデータは、CPU内のレジスタに格納される。

命令やデータを一時的に格納する小さな格納庫。

=> 高速な処理のためのCPU内部にある記憶装置(容量は極小)

主なレジスタの種類:

- プログラムカウンター : 次の命令のアドレスを格納するレジスタ
- 命令レジスタ : 命令を格納するレジスタ
- データを格納するレジスタ

## CPUが命令を処理する流れ

- 1 : CPUはプログラムカウンター(レジスタ)に格納されている次の命令のアドレス見て、主記憶装置に命令を取りに行く
- 2 : プログラムカウンターは一度参照されると、自動的に番号を加算(次の命令のアドレスを示すよう更新)
- 3 : 主記憶装置から取り出された命令は、命令レジスタ(レジスタ)に格納 => これが`フェッチ`
- 4 : 命令はCPUの中にある`命令デコーダ`で解読される
- 5 : 解読した命令の内容を実行(ここでは例として、4番地(アドレス)にあるデータを取り出せという指示)
- 6 : 取り出したデータは汎用レジスタ(レジスタ)に格納

## 割り込み

現在実行中のプログラムを中断して、別のプログラムに切り替えること。

割り込みが発生する要因はさまざまある。(後で :dog: )

割り込みが発生すると、CPUはプログラムカウンターにあるアドレスを別の場所に退避させ、割り込んできた命令のアドレスをプログラムカウンターにセットする。

割り込みの命令(処理)が完了したら、CPUは退避させていたアドレスをプログラムカウンターに復帰させて処理を最下位する。

割り込みは内部割込み・外部割込みに分類される。

- 内部割込み : 実行中のプログラムが原因で発生する割り込み
- 外部割込み : 実行中のプログラム以外が原因で発生する割り込み

---

# その他の記憶装置

- 主記憶装置(再度 :dog: )
- 補助記憶装置
- キャッシュメモリ

## 主記憶装置

CPUが直接読み書きを行う記憶装置。

CPUが処理できる命令の数には限りがあるので、主記憶装置に命令やデータを一時的に保管しておく。

主記憶装置は、(補助記憶装置に比べると)高速にデータを出し入れできるが、RAM(DRAM・SDRAM)のため電源を切ると保存されたたデータは消える。

## 補助記憶装置

主記憶装置を補助するための記憶装置。

主記憶装置と違い、ROMのため電源を切ってもデータが消えない。(長期保存できる)

補助記憶装置には、OSやアプリケーションソフトウェア、各種データなどが保存されている。

=> SSDやHDDが補助記憶装置にあたる

## キャッシュメモリ

CPUと主記憶装置の間にある超高速の記憶装置。

主記憶装置は補助記憶装置と比べると高速だが、CPUから見るとめちゃくちゃ遅い。

ので、その処理速度の差を埋めるために使用されるのがキャッシュメモリ。

主記憶装置よりも高速にアクセスできるので、よく使用するデータはキャッシュメモリに保存する方が処理速度が上がる。

SRAMで作られているので、主記憶装置よりも容量は少ない。

このキャッシュメモリに必要なデータがある確率のことを[ヒット率](hit.md)という。

CPUがデータを書込む際に、キャッシュメモリと主記憶装置装置のどちらにどう書込むかには2種類の方式がある。

- ライトスルー方式 : キャッシュメモリと主記憶装置に同時に書き込み
- ライトバック方式 : 通常はキャッシュメモリのみ・不要データをキャッシュメモリから追い出すときに主記憶装置へ書き込み

ライトスルーは、都度両方の記憶装置に書込むので仕組みがシンプル。

ライトバックは、主記憶装置への書き込み頻度が減るので書き込み速度が高速。

