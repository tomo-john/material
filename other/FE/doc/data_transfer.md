# データ転送

- ネットワーク : 複数のコンピューターを`回線`でつないだシステム
- 回線 : `データ`が通る線(伝送路・通信回線って言うこともある)

通信回線を使ってデータを送る方式には回線交換方式とパケット交換方式の2種類がある。

- 回線交換方式 : 通信回線を占有してデータをやり取りする => 伝送時間が遅くならない
- パケット交換方式 : データをパケット単位に分割し、複数の回線でデータをやり取りする

`パケット`とは、データを小分けにして、それぞれにヘッダー(制御情報)をつけた単位のこと。

ネットワーク(回線)を使用してデータをやり取りするには、以下の仕組みが必要。

- アナログ信号をデジタル信号に変換する仕組み
- データ転送中の誤りを見つける仕組み

通信中に、電気的なノイズなどの影響(電圧の変化)でビットの0と1が入れ替わってしまうことを`ビット誤り`という。

データを正しく転送するためには、このビット誤りを見つけて、正しいデータに直す必要がある。

ビット誤りを見つける方法には`パリティチェック方式`や`CRC方式`などがあり、これが試験に出る。

## パリティチェック方式(奇偶検査方式)

送信するビット列に検査用のビットを付け加えて送る方式。

送られたビット列と、検査用のビットを比べることでビット誤りを見つける。

ビット列の末尾に付け加える検査用ビットのことを`パリティビット`という。

- 奇数パリティ : ビット列の「1」の総数が奇数になるようにパリティビットを付ける
- 偶数パリティ : ビット列の「1」の総数が偶数になるようにパリティビットを付ける

偶数パリティの例:

| データ | 1の数 | パリティビット | 説明                                 |
|--------|-------|----------------|--------------------------------------|
| 101000 | 2個   | 0              | 2は偶数 => ビット加えなくてok        |
| 101001 | 3個   | 1              | 3は奇数 => 偶数になるように1を加える |

=> 偶数パリティの1が付いているのに、1の総数が奇数になっていたら、データに誤りがあることがわかる :dog:

パリティチェック方式では1ビットの誤りは検出可能だが、複数ビット(例えば2ビット誤れば正しいと誤認識)の誤りは検出できない。

なので次の`CRC方式`が現在は主流。

### 垂直パリティ

FE試験では基本的にパリティチェック方式は垂直パリティのことを指す。

でもパリティビットを付ける方式には他にも水平パリティと垂直水平パリティってのもある。

| 項目           | 内容                                               |
|----------------|----------------------------------------------------|
| パリティビット | 誤りの検出に使うビット(偶数パリティ／奇数パリティ) |
| 垂直パリティ   | バイト単位で付加。1ビット誤り検出できる            |
| 水平パリティ   | ビット列単位(列方向)。これも1ビット誤り検出        |
| 両方使うと     | 誤りの検出 + 位置特定(訂正) ができる               |
| CRCとの違い    | パリティは簡易、CRCは高精度なエラー検出に使われる  |

## CRC方式

CRC(Cyclic Redundancy Check)方式では、データをあらかじめ決められた`多項式(生成多項式)`で割り算し、その余りをチェックデータとして付与してデータを送る。

データを受け取った側は、同じ生成多項式で計算しチェックデータと同じであれば誤りなしと判断できる。

### CRCの多項式とは？

誤り検出符号を`2ビット`、マスクを`101`としたときのビット列`0010 0110`の符号を求める。

```

 0010 0110 00 # 2ビット0を加える

 0010 0110 00 # 左から最初の1を左端としマスク(101)でXORする
   10 1
 ------------
 0000 1110 00 # XORした結果

 0000 1110 00 # 同じく左端の1からマスクでXOR
      101
 ------------
 0000 0100 00 # XOR後

 0000 0100 00 # 繰り返す
       101
 ------------
 0000 0001 00 # もうちょい

 0000 0001 00 # 繰り返すのは最初のビットがすべて0になるまで
         1 01
 ------------
 0000 0000 01 # 全部0になった!
              # このとき右端に残った2ビットの01が誤り検出符号
```

