# open

## ファイル操作の王道パターン

```perl
open(my $fh, "<", "sample.txt") or die "開けない!: $!";
```

こらは、sample.txtを読み込みモードで開いて、ファイルハンドル`$fh`に結びつけるという意味。

| パーツ         | 意味                                             |
|----------------|--------------------------------------------------|
| `open(...)`    | ファイルを開く関数                               |
| `my $fh`       | ファイルハンドル(file handle)用の変数(スカラ)    |
| `"<"`          | モード: 読み込みモード                           |
| `sample.txt`   | 開きたいファイルの名前                           |
| `or die "..."` | 開けなかったらエラーを出してプログラムを終了する |
| `$!`           | 直前のエラー内容が入ってる(なぜ失敗したか確認)   |

### ファイルを開くモードいろいろ

| モード | 読み方   | 意味                           |
|--------|----------|--------------------------------|
| `<`    | 読み込み | ファイルから読む(上書きしない) |
| `>`    | 書き込み | ファイルに書く(上書きされる)   |
| `>>`   | 追記     | ファイルの末尾に追加する       |

- モードは文字列(例: "<")として渡す。なのでダブルクォートで囲む。

### my $fh って？

`$fh`はファイルハンドルと呼ばれるもの。

これはファイルにアクセスするためのハンドル(取っ手)みたいなもので、C言語でいう`FILE*`に近い。

昔のPerlでは、

```
open(FH, "<", "sample.txt);
```

のように書いていたが、これは`グローバル`なハンドルで、複数のファイルを扱うとバグりやすい。

今は`my $fh`みたいに`変数`として扱うのがモダンな書き方。

### or die のとこ

これは、もし`open`が失敗したら、エラーを出してプログラムを終了する安全策。

```
or die "ファイルを開けません: $!";
```

- `open(...)`が失敗 => `undef`を返す => `or`の右側が実行される
- `$!`には失敗した理由(システムエラー)が入っている

### 例

```perl
my $filename = "sample.txt";
open(my $fh, "<", $filename) or die "ファイルを開けません!: $!";

while (my $line = <$fh>) {
  chomp($line);
  print "読み込み内容: $line\n";
}

close($fh);
```

