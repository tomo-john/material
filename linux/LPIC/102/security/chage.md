# chage

chageは`change age`(パスワードの寿命)の略。

ユーザーアカウントのパスワードに有効期限や失効日などを設定するコマンド。

`chage [オプション] [ユーザー名` => オプションをつけずに実行すると対話モードになる

| オプション    | 説明                                                             | /etc/shadowのフィールド |
|---------------|------------------------------------------------------------------|-------------------------|
| -l            | パスワードもしくはアカウントの有効期限の表示                     | _                       |
| -d 日数       | パスワードの最終更新日を設定                                     | 3                       |
| -m 日数       | パスワード変更間隔の最低日数を設定                               | 4                       |
| -M 日数       | パスワードの最大有効期限日数を設定                               | 5                       |
| -W 日数       | パスワードの有効期限切れの警告が何日前から始まるかを設定         | 6                       |
| -I 日数       | パスワードの有効期限後にアカウントがロックされるまでの日数を設定 | 7                       |
| -E YYYY-MM-DD | ユーザーアカウントが無効になる日付を設定                         | 8                       |

```
chage -m 3 -M 28 -w 7 -I 0 -E 2025-12-31 john
```

- johnユーザーのパスワードは、変更には最低3日おかなければならない
- 最大期限は28日(4週間ごとに変更が必要)
- パスワードが切れる7日前から警告が始まる
- パスワードが切れると0日(つまり即時)にアカウントがロックされる
- アカウントの有効期限は2025/12/31まで

```
chage -d 0 john
```

- johnユーザーの最終バスワード変更日を0(つまり1970年1月1日)にする
- (次回ログイン時に)パスワード変更を強制したいときなどに使う

# /etc/passwd

各ユーザーの暗号化パスワードやパスワードの期限管理情報が記録されているファイル。

- `chage`コマンドの変更内容もこのファイルに反映される
- 所有者は`root:root`
- パーミッション : `-rw-r-----` => 通常は一般ユーザーは読めない

各フィールドは`:`で区切られる

```
john:$6$2Jh...:19500:0:90:7:14:19600:
```

| 項目            | 内容                                  | 例      | 補足                                             | chage |
|-----------------|---------------------------------------|---------|--------------------------------------------------|-------|
| 1: ユーザー名   | ユーザーの名前                        | `tomo`  | `/etc/passwd` のユーザーと一致                   | _     |
| 2: パスワード   | 暗号化されたパスワード                | `$6$～` | `$6$`はSHA-512で暗号化 => `!`や`*`はログイン不可 | _     |
| 3: 最終変更日   | 1970/1/1からの日数                    | `19500` | `date -d '1970-01-01 +19500 days'`で変換可能     | -d    |
| 4: 最短変更日数 | パスワード変更の最短日数              | `0`     | 0ならいつでも変更可能                            | -m    |
| 5: 最長使用日数 | パスワード有効日数                    | `90`    | 90日過ぎると変更を求められる                     | -M    |
| 6: 警告日数     | 期限前の警告日数                      | `7`     | 残り7日で警告開始                                | -w    |
| 7: 無効日数     | 期限切れ後に無効になるまでの日数      | `14`    | 放置するとアカウントがロックされる               | -I    |
| 8: 有効期限     | アカウントの失効日(1970年からの日数)  | `19600` | `date -d '1970-01-01 +19600 days'`               | -E    |
| 9: 予約         | 現在は未使用                          | `空欄`  | 保留フィールド                                   | _     |

