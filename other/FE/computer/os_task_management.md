# タスク管理(OS)

- ジョブ : ユーザーがコンピューターに出す命令
- タスク : OSがCPU(ハードウェア)に出す命令(プロセスともいう)

タスクはOSがCPUに出す命令の単位。この実行順序をOSが管理する。

## マルチタスク

複数のタスクを頻繁にすばやく切り替えることによって、複数のタスクがあたかも同時に実行されているかのように見せる技術。

=> 実際には同時に実行されているわけではない

=> CPUの1つのコアは1度に1つの作業しか実行できない

マルチタスクはCPUが単体で行なっているのではなく、OSがCPUを操作することで実現している

## タスク切り替え放法

### プリエンプティブ

CPUの使用権を`OS`が管理。

優先度が高いタスク発生時、優先度の低いタスクからCPU使用権を横取りし、優先度の高いタスクに割り当てる。

現在はプリエンプティブが主流。

### ノンプリエンプディブ

CPUの使用権を`タスク`が管理する方式。

タスクの処理が完了するまで、CPUの使用権はそのタスクが持つ。

処理が完了すると、タスク自身がCPUの使用権をOSに戻す。

CPUの使用権をOSが管理しないのでOSの役割がシンプルになる。

## タスクの状態

- 実行可能状態 : いつでもタスクを実行できる状態
- 実行状態 : タスクを実行している状態
- 待ち状態 : タスクの入出力処理の完了を待っている状態

### 1 タスクの生成

タスクが生成されると、実行可能状態になる

### 2 ディスパッチ

実行可能状態 => 実行状態へ

OSがタスクを実行状態に移すことをディスパッチという

### 3 優先度の高いタスクが発生

より優先度の高いタスクが発生すると、優先度の低いタスクは実行可能状態に戻り、優先度の高いタスクが実行状態に移る

=> これがプリエンプティブ

ノンプリエンプティブの場合、優先度の高いタスクはもとのタスクが終了するのを待ってから実行状態に移る

### 4 待ち状態

タスクに入出力処理が必要になると、実行状態から待ち状態に移る。

=> 入出力処理 : CPUが入出力装置や補助記憶装置(バッファ)などとデータやり取りをすること

入出力処理には時間がかかるので、CPUはタスクを待ち状態にして、別の実行可能状態のタスクを実行する。

入出力処理が完了すると、タスクは待ち状態から実行可能状態に移る

タスクの実行が完了すると、タスクは消滅する。

## タスクスケジューリング

- 到着順方式 : 先に到着したタスクを先に実行
- 処理時間方式 : 処理時間の短いタスクを先に実行
- 優先度方式 : 各タスクに優先度を与えて、その優先度順に実行
  - プリエンプティブの場合 : 優先度の高いタスクが発生したら、優先度の高いタスクに切り替える
  - ノンプリエンプティブの場合 : 優先度の高いタスクが発生しても、現在のタスクが終わるまで切り替えない
- ラウンドロビン方式 : タスクを一定時間ごとに切り替えて実行

